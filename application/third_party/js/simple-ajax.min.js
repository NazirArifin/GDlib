/* ===================================================================
 * simple-ajax.js v0.1.0
 * ===================================================================
 * Copyright (c) 2012, Nazir Arifin
 * All rights reserved.
 *
 * Inspired from bootstrap-ajax.js v0.1.0
 * Copyright (c) 2012, Eldarion, Inc.
 * =================================================================== */

!function($){'use strict';var Ajax=function(){};Ajax.prototype.click=function(e){var $this=$(this),url=$this.attr('href'),method=$this.attr('data-method'),callb=$this.attr('data-callback'),load=$this.attr('data-loading'),html=$this.html();if(!method){method='get';}
$this.attr('disabled','disabled');if(load){$this.html(load);}
e.preventDefault();$.ajax({url:url,type:method,statusCode:{200:function(data,status,xhr){var param={xhr:xhr,html:html,callback:callb};processData(data,$this,param);},500:function(data){processError(data,$this,{html:html});}}});}
Ajax.prototype.submit=function(e){var $this=$(this),url=$this.attr('action'),method=$this.attr('method'),data=$this.serialize(),callb=$this.attr('data-callback');if(!method){method='get';}
var $input=$($this.find('input[type="submit"], button[type="submit"]')[0]).attr('disabled','disabled');e.preventDefault();$.ajax({url:url,type:method,data:data,statusCode:{200:function(data,status,xhr){var param={xhr:xhr,html:undefined,callback:callb,input:$input};processData(data,$this,param);},500:function(data){processError(data,$this,undefined);}}});}
function processData(data,$el,param){var ct=param.xhr.getResponseHeader('content-type')||'';var type=ct.indexOf('json')>-1?'json':'html';var replace_selector=$el.attr('data-replace'),replace_closest_selector=$el.attr('data-replace-closest'),append_selector=$el.attr('data-append');if(replace_selector){$(replace_selector).html(type==='json'?data.html:data);}
if(replace_closest_selector){$(replace_closest_selector).html(type==='json'?data.html:data);}if(append_selector){$(append_selector).append(type==='json'?data.html:data);}if(param.callback){eval(param.callback);}if(param.html){$el.attr('disabled',false).html(param.html);}else{if(param.input.length){param.input.attr('disabled',false);}}}function processError(data,$el,param){console.log("ajax request fail:\n");console.log(data);if(param.html){$el.attr('disabled',false).html(param.html);}}function addEventAjax(){$('body').on('click','a.ajax',Ajax.prototype.click);$('body').on('submit','form.ajax',Ajax.prototype.submit);}
$(function(){addEventAjax();});}(window.jQuery);